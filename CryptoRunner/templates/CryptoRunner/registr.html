<!DOCTYPE html> {% load static %}
<html>

<head>
    <meta charset="utf-8">
    <title>{{title}}</title>
    <script src="https://unpkg.com/@solana/web3.js@latest/lib/index.iife.js"></script>
    <script src="https://unpkg.com/@solana/web3.js@latest/lib/index.iife.min.js"></script>
    <script>
        const url = "{% url 'registr'%}"
        async function conect() {
            try {
                const resp = await window.solana.connect();
                p = resp.publicKey.toString();
                // console.log(p);
                await getData('POST', url, {
                    'id': p
                });
                window.location.href = "{% url 'geim'%}";
            } catch (err) {
                window.open("https://phantom.app/", "_blank");
            }
        }

        async function getData(method, url, body = null) {
            return new Promise((resolve, reject) => {
                const xhr = new XMLHttpRequest()

                xhr.open(method, url)

                xhr.responseType = 'json'
                xhr.setRequestHeader('Content-Type', 'application/json')

                xhr.onload = () => {
                    if (xhr.status >= 400)
                        reject(xhr.response)
                    else
                        resolve(xhr.response)
                }

                xhr.onerror = () => {
                    reject(xhr.response)
                }

                xhr.send(JSON.stringify(body))
            })
        }

        async function dd() {
            const network = "<NETWORK_URL>";
            const connection = new Connection(network);
            const transaction = new Transaction();
            const {
                signature
            } = await window.solana.signAndSendTransaction(transaction);
            await connection.confirmTransaction(signature);
        }
    </script>
</head>
<body>
    <button onclick="conect()">подклучить</button>
</body>
</html>